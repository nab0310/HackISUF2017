<!DOCTYPE html>
<html lang="en">
<head>
  <title>Project Cube Man</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <link href="main.css" rel="stylesheet" type="text/css">
</head>
<body id="home" data-spy="scroll" data-target=".navbar" data-offset="60">

<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar navbar-header text-right">
            <!-- Condensed menu displays on mobile -->
            <button type="button" class="navbar-toggle mobile-only" data-toggle="collapse" data-target="#myNavbar" style="display:inline, hide;">
                <span style="float:left;"><strong>MENU &nbsp;</strong></span>
                <span class="glyphicon glyphicon-menu-hamburger" style="float:right; font-size:1.2em"></span>
            </button>
            <ul class="nav navbar-brand navbar-left">
                <li>Who's in the cube!?</li>
            </ul>
        </div>
        <div class="collapse navbar-collapse" id="myNavbar">
            <ul class="nav navbar-nav navbar-right">
                <!-- Need toggle and target to collapse correctly on mobile -->
                <li class="active"><a data-toggle="collapse" data-target=".navbar-collapse.in" href="#">HOME</a></li>
                <li><a data-toggle="collapse" data-target=".navbar-collapse.in" href="about.html">ABOUT</a></li>
                <li><a data-toggle="collapse" data-target=".navbar-collapse.in" href="tweet.html">TWEET COMMANDS</a></li>
                <li><a data-toggle="collapse" data-target=".navbar-collapse.in" href="polls.html">PAST POLLS</a></li>
                <li><a data-toggle="collapse" data-target=".navbar-collapse.in" href="https://github.com/nab0310/HackISUF2017" target="_blank">GITHUB</a></li>
                <li><a data-toggle="collapse" data-target=".navbar-collapse.in" href="contact.html">CONTACT</a></li>
            </ul>
        </div>
    </div>
</nav>
<br><br><br>
<div class="container-fluid">
  <div class="row content">
    <div class="col-sm-3 sidenav">
      <br>
      <h4 class="center">Current Top 10</h4>
      <table id="currentTop" style="width:100%" class="table table-striped table-condensed table-bordered">
        <caption align="bottom">Expires: <span id="expireTime">10min</span></caption>
        <tr>
            <th>ID</th>
            <th>Request</th>
            <th>Votes</th>
        </tr>
      </table>
      <hr>

      <!-- Live Twitter Feed -->
      <a class="twitter-timeline"  href="https://twitter.com/search?q=ProjectCube1" data-widget-id="921776789390798848">Tweets about ProjectCube1</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';
      if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";
      fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
      </script>
    </div>

    <div class="col-sm-9">
      <br>
      <h2>Live Stream</h2>
      <hr>
      <div id="vid1" class="center">
        <iframe width="700" height="400"
            src="http://www.youtube.com/embed/QEK-sTDwjj8" frameborder="0" allowfullscreen>
        </iframe>
        <hr>
        <iframe allowfullscreen="" width="700" height="400"
            src="http://www.youtube.com/live_chat?v=QEK-sTDwjj8&embed_domain=www.heroku.com/index.html" frameborder="0" allowfullscreen>
        </iframe>
      </div>
    </div>
  </div>
</div>

<footer class="container-fluid">
  <p>HackISU Fall 2017: A short weekend project</p>
</footer>

<script>
    var Twit = require('twit');
    // grab the packages we need
    var mongoose = require('mongoose');
    var MongoClient = require('mongodb').MongoClient;
    var url = 'mongodb://heroku_j8s76cm0:puh9lnhidinimuqbr7m6lm8umq@ds125565.mlab.com:25565/heroku_j8s76cm0';
    var myCollection;
    var db = MongoClient.connect(url, function(err, db) {
        if(err)
            throw err;
        console.log("Connected to the mongoDB!");
        myCollection = db.collection('tweets');
    });

    function returnTopTweets(tweetIdToReply, userHandle){
        var commands = myCollection.find().limit(10).sort({ "votes": 1 });
        commands.each(function(err, doc){
            console.log(doc);
        });
        return commands;
    }

    function getCurrentTop(){
        var data = returnTopTweets();

        var i;
        for(i=0; i < data.suggestions.length; i++){
            $("#currentTop").append($('<tr>')
                .append($('<td>')
                .text(data.suggestions[i].id)
                )
                .append($('<td>')
                .text(data.suggestions[i].request)
                )
                .append($('<td>')
                .text(data.suggestions[i].votes)
                )
            );
        }
    }

    $(document).ready(function(){
        getCurrentTop();
    });
</script>

</body>
</html>
